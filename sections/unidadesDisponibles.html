<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unidades Disponibles - Larrosa Camiones</title>
    <meta name="description" content="Explora nuestra amplia selecci√≥n de camiones usados. Filtra por marca, a√±o, kil√≥metros y m√°s. M√°s de 40 a√±os de experiencia en el sector.">
    <meta name="keywords" content="camiones usados, venta camiones, Larrosa, C√≥rdoba, Scania, Volvo, Mercedes, tractoras, r√≠gidos">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/unidadesDisponibles.css">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <!-- Navegaci√≥n fija -->
        <nav class="navbar">
            <div class="nav-container">
                <!-- Logo -->
                <div class="nav-logo">
                    <a href="../index.html">
                        <img src="../assets/Original.pdf" alt="Larrosa Camiones" class="logo">
                    </a>
                </div>
                
                <!-- Men√∫ principal -->
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="../index.html" class="nav-link">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a href="unidadesDisponibles.html" class="nav-link active">Unidades Disponibles</a>
                    </li>
                    <li class="nav-item">
                        <a href="LarrosaCamiones.html" class="nav-link">Larrosa Camiones</a>
                    </li>
                    <li class="nav-item">
                        <a href="contacto.html" class="nav-link">Contacto</a>
                    </li>
                </ul>
                
                <!-- Bot√≥n derecha -->
                <div class="nav-button">
                    <a href="LarrosaCamiones.html#randon" class="btn-special">
                        <img src="../assets/Logo negro sin fondo.png" alt="Randon" class="btn-icon">
                    </a>
                </div>
                
                <!-- Hamburger para m√≥vil -->
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Page Header -->
        <section class="page-header">
            <div class="container-full">
                <div class="breadcrumb">
                    <a href="../index.html">Inicio</a>
                    <span class="separator">/</span>
                    <span class="current">Unidades Disponibles</span>
                </div>
                
                <!-- Vehicle Categories Bar -->
                <div class="categories-container-full">
                    <div class="category-item active" data-category="all">
                        <div class="category-image">
                            <img src="../assets/imagenes/IMG_8670(1).JPEG" alt="Todos los veh√≠culos" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Todos</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                    
                    <div class="category-item" data-category="camion-tractor">
                        <div class="category-image">
                            <img src="../assets/Camion Tractor.png" alt="Cami√≥n Tractor" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Cami√≥n Tractor</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                    
                    <div class="category-item" data-category="camion-chasis">
                        <div class="category-image">
                            <img src="../assets/Camion Chasis.png" alt="Cami√≥n Chasis" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Cami√≥n Chasis</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                    
                    <div class="category-item" data-category="remolques">
                        <div class="category-image">
                            <img src="../assets/Remolques.png" alt="Remolques" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Remolques</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                    
                    <div class="category-item" data-category="utilitarios">
                        <div class="category-image">
                            <img src="../assets/Utilitarios.png" alt="Utilitarios" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Utilitarios</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                    
                    <div class="category-item" data-category="varios">
                        <div class="category-image">
                            <img src="../assets/Varios.png" alt="Varios" class="category-photo">
                        </div>
                        <div class="category-info">
                            <span class="category-name">Varios</span>
                            <span class="category-count">(0)</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content with Sidebar -->
        <section class="content-section-full">
            <div class="content-layout-full">
                <!-- Sidebar Filters -->
                <aside class="sidebar-filters-full">
                    <!-- Filter Search -->
                    <div class="filter-search">
                        <div class="search-input-container">
                            <input type="text" placeholder="Buscar camiones..." id="filter-search" class="filter-search-input">
                            <button class="clear-search-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filter-actions">
                            <button class="clear-all-btn">
                                <span>Limpiar</span>
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="save-search-btn">
                                <span>Guardar</span>
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Tipo Filter -->
                    <div class="filter-group collapsible collapsed">
                        <h3 class="filter-title" onclick="toggleFilterGroup(this)">
                            <span>Tipo</span>
                            <i class="fas fa-chevron-down collapse-icon"></i>
                        </h3>
                        <div class="filter-content">
                            <div class="filter-options">
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="tipo" value="camion-tractor">
                                    <span class="checkmark"></span>
                                    <img src="../assets/Camion Tractor.png" alt="Cami√≥n Tractor" class="filter-icon">
                                    <span class="option-text">Cami√≥n Tractor</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="tipo" value="camion-chasis">
                                    <span class="checkmark"></span>
                                    <img src="../assets/Camion Chasis.png" alt="Cami√≥n Chasis" class="filter-icon">
                                    <span class="option-text">Cami√≥n Chasis</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="tipo" value="remolques">
                                    <span class="checkmark"></span>
                                    <img src="../assets/Remolques.png" alt="Remolques" class="filter-icon">
                                    <span class="option-text">Remolques</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="tipo" value="utilitarios">
                                    <span class="checkmark"></span>
                                    <img src="../assets/Utilitarios.png" alt="Utilitarios" class="filter-icon">
                                    <span class="option-text">Utilitarios</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="tipo" value="varios">
                                    <span class="checkmark"></span>
                                    <img src="../assets/Varios.png" alt="Varios" class="filter-icon">
                                    <span class="option-text">Varios</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Marca Filter -->
                    <div class="filter-group collapsible collapsed">
                        <h3 class="filter-title" onclick="toggleFilterGroup(this)">
                            <span>Marca</span>
                            <i class="fas fa-chevron-down collapse-icon"></i>
                        </h3>
                        <div class="filter-content">
                            <div class="filter-options">
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="marca" value="scania">
                                    <span class="checkmark"></span>
                                    <span class="option-text">Scania</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="marca" value="volvo">
                                    <span class="checkmark"></span>
                                    <span class="option-text">Volvo</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="marca" value="mercedes">
                                    <span class="checkmark"></span>
                                    <span class="option-text">Mercedes</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="marca" value="iveco">
                                    <span class="checkmark"></span>
                                    <span class="option-text">Iveco</span>
                                </label>
                                <label class="filter-checkbox">
                                    <input type="checkbox" name="marca" value="volkswagen">
                                    <span class="checkmark"></span>
                                    <span class="option-text">Volkswagen</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- A√±o Range -->
                    <div class="filter-group collapsible collapsed">
                        <h3 class="filter-title" onclick="toggleFilterGroup(this)">
                            <span>A√±o</span>
                            <i class="fas fa-chevron-down collapse-icon"></i>
                        </h3>
                        <div class="filter-content">
                            <div class="range-filter">
                                <div class="range-inputs">
                                    <input type="number" placeholder="Desde" class="range-input" id="year-min" min="2000" max="2025">
                                    <span class="range-separator">-</span>
                                    <input type="number" placeholder="Hasta" class="range-input" id="year-max" min="2000" max="2025">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kil√≥metros Range -->
                    <div class="filter-group collapsible collapsed">
                        <h3 class="filter-title" onclick="toggleFilterGroup(this)">
                            <span>Kil√≥metros</span>
                            <i class="fas fa-chevron-down collapse-icon"></i>
                        </h3>
                        <div class="filter-content">
                            <div class="range-filter">
                                <div class="range-inputs">
                                    <input type="number" placeholder="Desde" class="range-input" id="km-min" min="0" max="1000000">
                                    <span class="range-separator">-</span>
                                    <input type="number" placeholder="Hasta" class="range-input" id="km-max" min="0" max="1000000">
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Main Content Area -->
                <div class="main-content-full">
                    <!-- Mobile Filter Toggle -->
                    <button class="mobile-filter-toggle">
                        <i class="fas fa-filter"></i>
                        <span>Filtros</span>
                    </button>

                    <!-- Results Header -->
                    <div class="results-header">
                        <div class="results-info">
                            <div class="results-tabs">
                                <button class="tab-btn active">
                                    <span>informaci√≥n</span>
                                </button>
                                <button class="tab-btn">
                                    <span><strong><span id="total-vehicles">0</span> veh√≠culos encontrados</strong></span>
                                </button>
                            </div>
                        </div>
                        <div class="results-controls">
                            <div class="sort-dropdown">
                                <button class="sort-btn">
                                    <span>Clasificar Por</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="sort-menu">
                                    <button class="sort-option active" data-sort="relevance">Relevancia</button>
                                    <button class="sort-option" data-sort="year-desc">A√±o: m√°s nuevo</button>
                                    <button class="sort-option" data-sort="year-asc">A√±o: m√°s viejo</button>
                                    <button class="sort-option" data-sort="km-asc">Menor kilometraje</button>
                                    <button class="sort-option" data-sort="km-desc">Mayor kilometraje</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Grid de Veh√≠culos -->
                    <div class="vehicles-grid" id="vehicles-grid">
                        <!-- Los veh√≠culos se cargar√°n aqu√≠ desde la API -->
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <h3>üîÑ Cargando veh√≠culos</h3>
                            <p>Conectando con la base de datos...</p>
                        </div>
                    </div>

                    <!-- Load More Button -->
                    <div class="load-more-container">
                        <button class="load-more-btn" id="load-more-btn" style="display: none;">
                            <span>Cargar m√°s veh√≠culos</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Overlay para m√≥vil -->
    <div class="filter-overlay" id="filter-overlay"></div>
    
    <!-- Brands Section -->
    <section class="brands">
        <div class="container">
            <div class="brands-carousel">
                <div class="brands-track">
                    <img src="../assets/Scania.png" alt="Scania" class="brand-logo">
                    <img src="../assets/Volvo.png" alt="Volvo" class="brand-logo">
                    <img src="../assets/Mercedez.png" alt="Mercedes-Benz" class="brand-logo">
                    <img src="../assets/Iveco.png" alt="Iveco" class="brand-logo">
                    <img src="../assets/Volkswagen.png" alt="Volkswagen" class="brand-logo">
                    <img src="../assets/Renault.png" alt="Renault" class="brand-logo">
                    <img src="../assets/Ford.png" alt="Ford" class="brand-logo">
                    <img src="../assets/Logo negro sin fondo.png" alt="Randon" class="brand-logo">
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <img src="../assets/Blanco fondo negro.pdf" alt="Larrosa Camiones" class="footer-logo">
                    <p>40 a√±os comercializando camiones. Tu socio confiable en el transporte de cargas.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>Navegaci√≥n</h4>
                    <ul>
                        <li><a href="../index.html">Inicio</a></li>
                        <li><a href="unidadesDisponibles.html">Unidades Disponibles</a></li>
                        <li><a href="LarrosaCamiones.html">Larrosa Camiones</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>La Empresa</h4>
                    <ul>
                        <li><a href="LarrosaCamiones.html#historia">Nuestra Historia</a></li>
                        <li><a href="LarrosaCamiones.html#valores">Valores</a></li>
                        <li><a href="LarrosaCamiones.html#randon">Concesi√≥n Randon</a></li>
                        <li><a href="LarrosaCamiones.html#instalaciones">Instalaciones</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Contacto</h4>
                    <div class="contact-info">
                        <p><i class="fas fa-map-marker-alt"></i> Villa Mar√≠a, C√≥rdoba</p>
                        <p><i class="fas fa-phone"></i> +54 353 XXX-XXXX</p>
                        <p><i class="fas fa-envelope"></i> info@larrosacamiones.com</p>
                    </div>
                </div>
            </div>
            
            <!-- Admin section -->
            <div class="footer-admin">
                <a href="../admin/login.html" 
                   class="btn-admin-footer" 
                   title="Panel de Administraci√≥n">
                    <i class="fas fa-user-shield"></i>
                    <span>Administraci√≥n</span>
                </a>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Larrosa Camiones. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../scripts/nav-session.js"></script>
    
    <!-- SOLO EL SCRIPT DE LA API - SIN CONFLICTOS -->
    <script>
        // Limpiar variables globales anteriores para evitar conflictos
        console.log('üßπ Limpiando scripts previos...');
        
        // Remover cualquier implementaci√≥n anterior
        if (window.vehiclesData) delete window.vehiclesData;
        if (window.filteredVehicles) delete window.filteredVehicles;
        if (window.unidadesAPILoaded) delete window.unidadesAPILoaded;
        
        console.log('‚úÖ Scripts limpiados, cargando implementaci√≥n API...');
    </script>
    
    <!-- Cargar SOLO el sistema API -->
    <script>
        // ===== SISTEMA UNIDADES DISPONIBLES - API INTEGRACI√ìN COMPLETA =====

        // Configuraci√≥n
        const API_CONFIG = {
            baseURL: 'http://localhost:8000/api/v1',
            timeout: 10000
        };

        // Variables globales
        let vehiclesData = [];
        let filteredVehicles = [];
        let currentFilters = { category: 'all', search: '' };
        let isLoading = false;

        // ===== CLASE PRINCIPAL =====
        class UnidadesAPI {
            constructor() {
                this.init();
            }

            async init() {
                console.log('üöõ Iniciando Unidades Disponibles con API...');
                
                // Verificar conexi√≥n
                const connected = await this.testConnection();
                
                if (connected) {
                    console.log('‚úÖ Conectado a la API');
                    await this.loadVehicles();
                } else {
                    console.warn('‚ö†Ô∏è API no disponible');
                    this.showConnectionError();
                }
                
                // Inicializar componentes
                this.setupCategories();
                this.setupFilters();
                this.setupUI();
            }

            async testConnection() {
                try {
                    const response = await fetch(`${API_CONFIG.baseURL.replace('/api/v1', '')}/health`, {
                        method: 'GET',
                        timeout: 5000
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('üîó Backend status:', data.status);
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('‚ùå Error de conexi√≥n:', error.message);
                    return false;
                }
            }

            async loadVehicles() {
                try {
                    this.showLoading(true);
                    console.log('üì¶ Cargando veh√≠culos desde API...');
                    
                    const response = await fetch(`${API_CONFIG.baseURL}/vehicles?limit=1000`, {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('üìä Datos recibidos:', data);

                    if (data.vehicles && Array.isArray(data.vehicles)) {
                        vehiclesData = data.vehicles;
                        filteredVehicles = [...vehiclesData];
                        
                        console.log(`‚úÖ ${vehiclesData.length} veh√≠culos cargados`);
                        
                        this.updateVehicleCount(vehiclesData.length);
                        this.updateCategoryCounters();
                        this.renderVehicles();
                        
                    } else {
                        console.warn('‚ö†Ô∏è Estructura de datos inesperada:', data);
                        this.showEmptyState('Estructura de datos inesperada');
                    }

                } catch (error) {
                    console.error('‚ùå Error cargando veh√≠culos:', error);
                    this.showError(`Error cargando veh√≠culos: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            renderVehicles() {
                const grid = document.getElementById('vehicles-grid');
                if (!grid) {
                    console.error('‚ùå Grid de veh√≠culos no encontrado');
                    return;
                }

                console.log(`üé® Renderizando ${filteredVehicles.length} veh√≠culos...`);

                if (filteredVehicles.length === 0) {
                    this.showEmptyState('No se encontraron veh√≠culos con los filtros seleccionados');
                    return;
                }

                // Limpiar grid
                grid.innerHTML = '';

                // Crear cards
                filteredVehicles.forEach((vehicle, index) => {
                    const card = this.createVehicleCard(vehicle);
                    if (card) {
                        card.style.animationDelay = `${index * 0.05}s`;
                        card.classList.add('fade-in');
                        grid.appendChild(card);
                    }
                });

                console.log(`‚úÖ ${filteredVehicles.length} tarjetas renderizadas`);
            }

            createVehicleCard(vehicle) {
                if (!vehicle) return null;

                const card = document.createElement('div');
                card.className = 'vehicle-card';
                card.dataset.vehicleId = vehicle.id;
                card.dataset.vehicleData = JSON.stringify(vehicle);

                const imageUrl = this.getVehicleImageUrl(vehicle);
                const statusClass = this.getStatusClass(vehicle.status);

                card.innerHTML = `
                    <div class="vehicle-image">
                        <img src="${imageUrl}" 
                             alt="${vehicle.full_name || vehicle.fullName || 'Veh√≠culo'}" 
                             loading="lazy"
                             onerror="this.src='../assets/imagenes/placeholder-vehicle.jpg'">
                        <div class="vehicle-status ${statusClass}">
                            ${vehicle.status || 'Disponible'}
                        </div>
                        ${vehicle.is_featured ? '<div class="vehicle-featured">‚≠ê Destacado</div>' : ''}
                    </div>
                    <div class="vehicle-content">
                        <h3 class="vehicle-title">${vehicle.full_name || vehicle.fullName || 'Veh√≠culo sin nombre'}</h3>
                        <p class="vehicle-subtitle">${vehicle.description || vehicle.type_name || vehicle.typeName || 'Veh√≠culo comercial'}</p>
                        <div class="vehicle-specs">
                            <div class="vehicle-spec">
                                <span class="vehicle-spec-icon">üìÖ</span>
                                <span class="vehicle-spec-value">${vehicle.year || 'N/A'}</span>
                            </div>
                            <div class="vehicle-spec">
                                <span class="vehicle-spec-icon">üõ£Ô∏è</span>
                                <span class="vehicle-spec-value">${this.formatNumber(vehicle.kilometers || 0)} km</span>
                            </div>
                            <div class="vehicle-spec">
                                <span class="vehicle-spec-icon">‚öôÔ∏è</span>
                                <span class="vehicle-spec-value">${vehicle.transmission || 'Manual'}</span>
                            </div>
                            <div class="vehicle-spec">
                                <span class="vehicle-spec-icon">üîã</span>
                                <span class="vehicle-spec-value">${vehicle.power || 0} HP</span>
                            </div>
                        </div>
                    </div>
                    <div class="vehicle-footer">
                        <div class="vehicle-location">
                            <span>üá¶üá∑</span>
                            <span>${vehicle.location || 'Villa Mar√≠a, C√≥rdoba'}</span>
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    this.goToVehicleDetail(vehicle);
                });

                return card;
            }

            setupCategories() {
                const categoryItems = document.querySelectorAll('.category-item');
                
                categoryItems.forEach(item => {
                    item.addEventListener('click', () => {
                        categoryItems.forEach(cat => cat.classList.remove('active'));
                        item.classList.add('active');
                        
                        const category = item.dataset.category;
                        this.filterByCategory(category);
                    });
                });
            }

            setupFilters() {
                const searchInput = document.getElementById('filter-search');
                if (searchInput) {
                    searchInput.addEventListener('input', this.debounce((e) => {
                        currentFilters.search = e.target.value.toLowerCase();
                        this.applyFilters();
                    }, 300));
                }

                const clearBtn = document.querySelector('.clear-all-btn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        this.clearAllFilters();
                    });
                }
            }

            setupUI() {
                this.setupMobileToggle();
                this.setupSorting();
            }

            setupMobileToggle() {
                const toggleBtn = document.querySelector('.mobile-filter-toggle');
                const sidebar = document.querySelector('.sidebar-filters-full');
                const overlay = document.getElementById('filter-overlay');

                if (toggleBtn && sidebar && overlay) {
                    toggleBtn.addEventListener('click', () => {
                        sidebar.classList.toggle('active');
                        overlay.classList.toggle('active');
                        document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
                    });

                    overlay.addEventListener('click', () => {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    });
                }
            }

            setupSorting() {
                const sortBtn = document.querySelector('.sort-btn');
                const sortMenu = document.querySelector('.sort-menu');
                const sortOptions = document.querySelectorAll('.sort-option');

                if (sortBtn && sortMenu) {
                    sortBtn.addEventListener('click', () => {
                        sortMenu.style.display = sortMenu.style.display === 'block' ? 'none' : 'block';
                    });
                }

                sortOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const sortType = option.dataset.sort;
                        this.sortVehicles(sortType);
                        sortMenu.style.display = 'none';
                    });
                });
            }

            filterByCategory(category) {
                console.log(`üè∑Ô∏è Filtrando por categor√≠a: ${category}`);
                currentFilters.category = category;
                this.applyFilters();
            }

            applyFilters() {
                console.log('üîç Aplicando filtros:', currentFilters);
                
                filteredVehicles = vehiclesData.filter(vehicle => {
                    if (currentFilters.category && currentFilters.category !== 'all') {
                        if (vehicle.type !== currentFilters.category) {
                            return false;
                        }
                    }
                    
                    if (currentFilters.search) {
                        const searchText = `${vehicle.brand} ${vehicle.model} ${vehicle.full_name || vehicle.fullName}`.toLowerCase();
                        if (!searchText.includes(currentFilters.search)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                console.log(`üìä ${filteredVehicles.length} veh√≠culos despu√©s del filtro`);
                
                this.updateVehicleCount(filteredVehicles.length);
                this.renderVehicles();
            }

            clearAllFilters() {
                currentFilters = { category: 'all', search: '' };
                
                const searchInput = document.getElementById('filter-search');
                if (searchInput) searchInput.value = '';
                
                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector('[data-category="all"]')?.classList.add('active');
                
                this.applyFilters();
            }

            sortVehicles(sortType) {
                console.log(`üìä Ordenando por: ${sortType}`);
                
                filteredVehicles.sort((a, b) => {
                    switch (sortType) {
                        case 'year-desc':
                            return (b.year || 0) - (a.year || 0);
                        case 'year-asc':
                            return (a.year || 0) - (b.year || 0);
                        case 'km-asc':
                            return (a.kilometers || 0) - (b.kilometers || 0);
                        case 'km-desc':
                            return (b.kilometers || 0) - (a.kilometers || 0);
                        case 'relevance':
                        default:
                            if (a.is_featured && !b.is_featured) return -1;
                            if (!a.is_featured && b.is_featured) return 1;
                            return new Date(b.created_at || b.date_added || 0) - new Date(a.created_at || a.date_added || 0);
                    }
                });
                
                this.renderVehicles();
            }

            getVehicleImageUrl(vehicle) {
                if (vehicle.images && vehicle.images.length > 0) {
                    const imagePath = vehicle.images[0];
                    
                    if (imagePath.startsWith('http')) {
                        return imagePath;
                    }
                    
                    if (imagePath.startsWith('/static') || imagePath.startsWith('static')) {
                        return `http://localhost:8000/${imagePath.replace(/^\//, '')}`;
                    }
                    
                    return imagePath;
                }
                
                return '../assets/imagenes/placeholder-vehicle.jpg';
            }

            getStatusClass(status) {
                if (!status) return 'available';
                
                const statusLower = status.toLowerCase();
                if (statusLower.includes('disponible')) return 'available';
                if (statusLower.includes('reservado')) return 'reserved';
                if (statusLower.includes('vendido')) return 'sold';
                return 'available';
            }

            formatNumber(num) {
                if (!num) return '0';
                return new Intl.NumberFormat('es-AR').format(num);
            }

            updateVehicleCount(count) {
                const totalElement = document.getElementById('total-vehicles');
                if (totalElement) {
                    totalElement.textContent = count;
                }
            }

            updateCategoryCounters() {
                const categoryCounts = {